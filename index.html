<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CryptoSwap.live - Cosmetic Crypto Swap</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron&family=Roboto:wght@400;700&display=swap');

    :root {
      --bg-dark: #121214;
      --bg-darker: #0b0b0d;
      --accent: #8e44ad; /* purple */
      --accent-hover: #732d91;
      --text-light: #e1e1e6;
      --text-muted: #9a8cbf;
      --input-bg: #1e1e22;
      --input-border: #3a2a56;
      --swap-btn-bg: #8e44ad;
      --swap-btn-bg-hover: #732d91;
      --shadow: 0 0 15px rgba(142, 68, 173, 0.7);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      user-select: none;
    }

    header {
      padding: 1.5rem 2rem;
      background: var(--bg-darker);
      box-shadow: var(--shadow);
      text-align: center;
      user-select:none;
    }

    header h1 {
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      font-size: 2.3rem;
      letter-spacing: 3px;
      margin: 0;
      color: var(--accent);
    }

    main {
      flex: 1;
      max-width: 900px;
      margin: 2rem auto 4rem auto;
      padding: 0 1rem;
    }

    .swap-container {
      background: var(--bg-darker);
      padding: 2.2rem 2.5rem;
      border-radius: 14px;
      box-shadow: var(--shadow);
      max-width: 520px;
      margin: 0 auto 3.5rem auto;
    }

    .swap-container h2 {
      margin-top: 0;
      font-weight: 700;
      font-size: 1.8rem;
      margin-bottom: 2rem;
      color: var(--accent);
      user-select:none;
    }

    form.swap-form {
      display: flex;
      flex-direction: column;
      gap: 1.3rem;
    }

    label {
      font-weight: 700;
      margin-bottom: 0.4rem;
      color: var(--text-muted);
      user-select:none;
    }

    select, input[type="number"] {
      width: 100%;
      background: var(--input-bg);
      border: 2px solid var(--input-border);
      border-radius: 10px;
      padding: 0.9rem 1.3rem;
      color: var(--text-light);
      font-size: 1.15rem;
      font-weight: 600;
      transition: border-color 0.3s ease;
      font-family: 'Roboto', sans-serif;
      letter-spacing: 0.03em;
      user-select:text;
    }

    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 14px var(--accent);
    }

    button.swap-btn {
      margin-top: 2rem;
      padding: 1.1rem 0;
      background: var(--swap-btn-bg);
      border: none;
      color: #fff;
      font-weight: 800;
      font-size: 1.3rem;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      font-family: 'Orbitron', monospace;
      letter-spacing: 0.05em;
    }

    button.swap-btn:hover:not(:disabled) {
      background: var(--accent-hover);
      box-shadow: 0 0 20px var(--accent-hover);
    }

    button.swap-btn:disabled {
      background: #5c427b;
      cursor: not-allowed;
      box-shadow: none;
    }

    .rate-display {
      margin-top: 1.7rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-muted);
      user-select:none;
      min-height: 1.4rem;
      letter-spacing: 0.03em;
    }

    .history-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 1.3rem 2rem;
      background: var(--bg-darker);
      border-radius: 14px;
      box-shadow: var(--shadow);
      color: var(--text-light);
      user-select:none;
    }

    .history-container h3 {
      margin-top: 0;
      font-weight: 700;
      font-size: 1.5rem;
      margin-bottom: 1.4rem;
      color: var(--accent);
      user-select:none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-variant-numeric: tabular-nums;
    }

    th, td {
      text-align: left;
      padding: 0.75rem 0.9rem;
      font-weight: 600;
      font-size: 1rem;
      font-family: 'Roboto', sans-serif;
    }

    thead th {
      border-bottom: 3px solid var(--accent);
      color: var(--accent);
    }

    tbody tr {
      border-bottom: 1.3px solid #311a5d;
      transition: background-color 0.25s ease;
    }

    tbody tr:hover {
      background: #290f4a;
    }

    tbody td {
      color: var(--text-light);
      user-select:text;
    }
  </style>
</head>
<body>

<header>
  <h1>CryptoSwap.live</h1>
</header>

<main>
  <section class="swap-container" aria-label="Swap form">
    <h2>Swap Tokens</h2>
    <form class="swap-form" id="swap-form" autocomplete="off" novalidate>
      <div>
        <label for="from-token">From</label>
        <select id="from-token" name="from-token" required aria-required="true" aria-label="Select token to swap from">
          <option value="" disabled selected>Select token</option>
          <option value="BTC">Bitcoin (BTC)</option>
          <option value="ETH">Ethereum (ETH)</option>
          <option value="USDT">Tether (USDT)</option>
          <option value="BNB">Binance Coin (BNB)</option>
          <option value="ADA">Cardano (ADA)</option>
          <option value="SOL">Solana (SOL)</option>
          <option value="LTC">Litecoin (LTC)</option>
        </select>
      </div>

      <div>
        <label for="from-amount">Amount</label>
        <input type="number" id="from-amount" name="from-amount" min="0" step="any" placeholder="0.0" required aria-required="true" />
      </div>

      <div>
        <label for="to-token">To</label>
        <select id="to-token" name="to-token" required aria-required="true" aria-label="Select token to swap to">
          <option value="" disabled selected>Select token</option>
          <option value="BTC">Bitcoin (BTC)</option>
          <option value="ETH">Ethereum (ETH)</option>
          <option value="USDT">Tether (USDT)</option>
          <option value="BNB">Binance Coin (BNB)</option>
          <option value="ADA">Cardano (ADA)</option>
          <option value="SOL">Solana (SOL)</option>
          <option value="LTC">Litecoin (LTC)</option>
        </select>
      </div>

      <button type="submit" class="swap-btn" disabled>Swap</button>

      <div class="rate-display" aria-live="polite" aria-atomic="true" id="rate-display">
        Select tokens and amount to see estimated rate
      </div>
    </form>
  </section>

  <section class="history-container" aria-label="Recent swap history">
    <h3>Recent Swaps</h3>
    <table role="table" aria-describedby="history-description">
      <thead>
        <tr>
          <th scope="col">Date & Time</th>
          <th scope="col">From</th>
          <th scope="col">Amount</th>
          <th scope="col">To</th>
          <th scope="col">Received</th>
        </tr>
      </thead>
      <tbody id="swap-history">
        <!-- dummy rows inserted by JS -->
      </tbody>
    </table>
    <p id="history-description" class="sr-only">Table showing recent cosmetic token swaps with date, tokens, and amounts</p>
  </section>
</main>

<script>
  (() => {
    const fromTokenSelect = document.getElementById('from-token');
    const toTokenSelect = document.getElementById('to-token');
    const fromAmountInput = document.getElementById('from-amount');
    const swapBtn = document.querySelector('button.swap-btn');
    const rateDisplay = document.getElementById('rate-display');
    const historyTbody = document.getElementById('swap-history');

    const tokenIds = {
      BTC: 'bitcoin',
      ETH: 'ethereum',
      USDT: 'tether',
      BNB: 'binancecoin',
      ADA: 'cardano',
      SOL: 'solana',
      LTC: 'litecoin'
    };

    let usdPrices = {};

    // Initial dummy transactions data, times spaced randomly 5-20 min apart in the past
    const baseTime = Date.now();
    let swapHistory = [];

    // Helper: Random number between min and max inclusive
    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Helper: Format date YYYY-MM-DD HH:mm:ss
    function formatDate(date) {
      const pad = n => n.toString().padStart(2, '0');
      return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())} ` +
             `${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
    }

    // Initialize dummy swaps spaced in the past randomly
    function initDummySwaps() {
      let lastTime = baseTime - (60 * 60 * 1000); // 1 hour ago
      const tokens = Object.keys(tokenIds);
      swapHistory = [];

      for (let i = 0; i < 10; i++) {
        // time is lastTime + random 5-20 min
        const minutesGap = randomInt(5, 20);
        lastTime += minutesGap * 60 * 1000;

        // random tokens and amounts
        let fromToken = tokens[randomInt(0, tokens.length -1)];
        let toToken;
        do {
          toToken = tokens[randomInt(0, tokens.length -1)];
        } while(toToken === fromToken);

        let amount = +(Math.random() * (10 - 0.1) + 0.1).toFixed(5);

        // Calculate received based on last fetched prices (or 1 if not loaded yet)
        const fromPrice = usdPrices[fromToken] || 1;
        const toPrice = usdPrices[toToken] || 1;
        const received = +(amount * fromPrice / toPrice).toFixed(5);

        swapHistory.push({
          date: new Date(lastTime),
          fromToken,
          toToken,
          amount,
          received
        });
      }
    }

    function renderHistory() {
      historyTbody.innerHTML = '';
      for (const swap of swapHistory.slice().reverse()) {
        const tr = document.createElement('tr');

        const tdDate = document.createElement('td');
        tdDate.textContent = formatDate(swap.date);
        tr.appendChild(tdDate);

        const tdFrom = document.createElement('td');
        tdFrom.textContent = swap.fromToken;
        tr.appendChild(tdFrom);

        const tdAmount = document.createElement('td');
        tdAmount.textContent = swap.amount.toFixed(5);
        tr.appendChild(tdAmount);

        const tdTo = document.createElement('td');
        tdTo.textContent = swap.toToken;
        tr.appendChild(tdTo);

        const tdReceived = document.createElement('td');
        tdReceived.textContent = swap.received.toFixed(5);
        tr.appendChild(tdReceived);

        historyTbody.appendChild(tr);
      }
    }

    function addNewDummySwap() {
      const tokens = Object.keys(tokenIds);
      const lastDate = swapHistory.length > 0 ? swapHistory[swapHistory.length-1].date.getTime() : Date.now();

      // New swap time 5-20 mins after last swap time
      const newDateMs = lastDate + randomInt(5,20) * 60 * 1000;

      // Random tokens distinct
      let fromToken = tokens[randomInt(0, tokens.length -1)];
      let toToken;
      do {
        toToken = tokens[randomInt(0, tokens.length -1)];
      } while(toToken === fromToken);

      const amount = +(Math.random() * (10 - 0.1) + 0.1).toFixed(5);
      const fromPrice = usdPrices[fromToken] || 1;
      const toPrice = usdPrices[toToken] || 1;
      const received = +(amount * fromPrice / toPrice).toFixed(5);

      swapHistory.push({
        date: new Date(newDateMs),
        fromToken,
        toToken,
        amount,
        received
      });

      // Keep history max 20
      if (swapHistory.length > 20) {
        swapHistory.shift();
      }

      renderHistory();
    }

    function validateForm() {
      const fromToken = fromTokenSelect.value;
      const toToken = toTokenSelect.value;
      const amount = parseFloat(fromAmountInput.value);

      const valid = fromToken && toToken && fromToken !== toToken && amount > 0;
      swapBtn.disabled = !valid;

      if (!valid) {
        rateDisplay.textContent = 'Select tokens and amount to see estimated rate';
        return false;
      }
      return true;
    }

    async function fetchPrices() {
      const ids = Object.values(tokenIds).join(',');
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Network response not ok');
        const data = await res.json();
        usdPrices = {};
        for (const [symbol, id] of Object.entries(tokenIds)) {
          usdPrices[symbol] = data[id]?.usd || null;
        }
      } catch(e) {
        console.error('Error fetching prices:', e);
      }
    }

    function updateRate() {
      if (!validateForm()) return;

      const fromToken = fromTokenSelect.value;
      const toToken = toTokenSelect.value;
      const amount = parseFloat(fromAmountInput.value);

      const fromPrice = usdPrices[fromToken];
      const toPrice = usdPrices[toToken];

      if (fromPrice == null || toPrice == null) {
        rateDisplay.textContent = 'Live price data unavailable. Please try again later.';
        return;
      }

      const rate = fromPrice / toPrice;
      const received = amount * rate;

      rateDisplay.textContent = `Estimated: ${received.toFixed(6)} ${toToken} (Rate: 1 ${fromToken} ≈ ${rate.toFixed(6)} ${toToken})`;
    }

    function handleSwapSubmit(e) {
      e.preventDefault();

      if (!validateForm()) return;

      const fromToken = fromTokenSelect.value;
      const toToken = toTokenSelect.value;
      const amount = parseFloat(fromAmountInput.value);

      const fromPrice = usdPrices[fromToken];
      const toPrice = usdPrices[toToken];
      if (fromPrice == null || toPrice == null) {
        alert('Price data unavailable. Please try again.');
        return;
      }

      const rate = fromPrice / toPrice;
      const received = amount * rate;

      swapHistory.push({
        date: new Date(),
        fromToken,
        toToken,
        amount,
        received
      });

      if (swapHistory.length > 20) {
        swapHistory.shift();
      }

      renderHistory();

      fromTokenSelect.value = "";
      toTokenSelect.value = "";
      fromAmountInput.value = "";
      swapBtn.disabled = true;
      rateDisplay.textContent = 'Select tokens and amount to see estimated rate';
    }

    // Initialize dummy swaps after prices load
    async function init() {
      await fetchPrices();
      initDummySwaps();
      renderHistory();
      updateRate();
    }

    // Periodic update prices + rate every 60s
    setInterval(async () => {
      await fetchPrices();
      updateRate();
    }, 60000);

    // Add new dummy transaction every 3-7 mins
    setInterval(() => {
      addNewDummySwap();
    }, randomInt(180000, 420000)); // 3-7 minutes in ms, randomized on each reload

    [fromTokenSelect, toTokenSelect, fromAmountInput].forEach(el => {
      el.addEventListener('input', () => updateRate());
    });

    document.getElementById('swap-form').addEventListener('submit', handleSwapSubmit);

    init();
  })();
</script>

</body>
</html>
