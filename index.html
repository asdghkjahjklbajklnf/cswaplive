<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CryptoSwap.live - Cosmetic Crypto Swap</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0f0f10;
      color: #e1e1e6;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: #1c1c1f;
      border-bottom: 1px solid #333;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    .swap-container, .history-container {
      padding: 2rem;
      max-width: 600px;
      margin: 0 auto;
    }
    .swap-form label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
    }
    .swap-form select, .swap-form input {
      width: 100%;
      padding: 0.5rem;
      background: #1e1e22;
      border: 1px solid #444;
      border-radius: 0.5rem;
      color: #fff;
    }
    .swap-btn {
      width: 100%;
      padding: 0.75rem;
      margin-top: 1.5rem;
      background-color: #9b5de5;
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-weight: bold;
      cursor: pointer;
    }
    .rate-display {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #d3a7f2;
    }
    .history-container table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      color: #ddd;
    }
    .history-container th, .history-container td {
      padding: 0.5rem;
      border-bottom: 1px solid #333;
      text-align: left;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: #1c1c1f;
      padding: 2rem;
      border-radius: 1rem;
      text-align: center;
      color: #fff;
    }
    .modal-close-btn {
      margin-top: 1rem;
      background: #444;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    .wallet-address {
      background: #2a2a2e;
      padding: 0.75rem;
      border-radius: 0.5rem;
      margin-top: 0.5rem;
      word-break: break-all;
    }
  </style>
</head>
<body>

<header>
  <h1>CryptoSwap.live</h1>
  <button id="wallet-btn">Connect Wallet</button>
</header>

<main>
  <section class="swap-container" aria-label="Swap form">
    <h2>Swap Tokens</h2>
    <form class="swap-form" id="swap-form" autocomplete="off" novalidate>
      <div>
        <label for="from-token">From</label>
        <select id="from-token" required>
          <option value="" disabled selected>Select token</option>
          <option value="BTC">Bitcoin (BTC)</option>
          <option value="ETH">Ethereum (ETH)</option>
          <option value="USDT">Tether (USDT)</option>
          <option value="BNB">Binance Coin (BNB)</option>
          <option value="ADA">Cardano (ADA)</option>
          <option value="SOL">Solana (SOL)</option>
          <option value="LTC">Litecoin (LTC)</option>
        </select>
      </div>

      <div>
        <label for="from-amount">Amount</label>
        <input type="number" id="from-amount" min="0" step="any" placeholder="0.0" required />
      </div>

      <div>
        <label for="to-token">To</label>
        <select id="to-token" required>
          <option value="" disabled selected>Select token</option>
          <option value="BTC">Bitcoin (BTC)</option>
          <option value="ETH">Ethereum (ETH)</option>
          <option value="USDT">Tether (USDT)</option>
          <option value="BNB">Binance Coin (BNB)</option>
          <option value="ADA">Cardano (ADA)</option>
          <option value="SOL">Solana (SOL)</option>
          <option value="LTC">Litecoin (LTC)</option>
        </select>
      </div>

      <button type="submit" class="swap-btn" disabled>Swap</button>

      <div class="rate-display" id="rate-display">
        Select tokens and amount to see estimated rate
      </div>
    </form>
  </section>

  <section class="history-container" aria-label="Recent swap history">
    <h3>Recent Swaps</h3>
    <table>
      <thead>
        <tr>
          <th>Date & Time</th>
          <th>From</th>
          <th>Amount</th>
          <th>To</th>
          <th>Received</th>
        </tr>
      </thead>
      <tbody id="swap-history"></tbody>
    </table>
  </section>
</main>

<div class="modal" id="wallet-modal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h4>Connected Wallet</h4>
    <div class="wallet-address" id="wallet-address">0x1234...ABCD5678EF90</div>
    <button class="modal-close-btn" id="wallet-close-btn">Close</button>
  </div>
</div>

<script>
(() => {
  const tokenIds = {
    BTC: 'bitcoin', ETH: 'ethereum', USDT: 'tether',
    BNB: 'binancecoin', ADA: 'cardano', SOL: 'solana', LTC: 'litecoin'
  };
  let usdPrices = {};
  let swapHistory = [];
  const fromToken = document.getElementById('from-token');
  const toToken = document.getElementById('to-token');
  const amountInput = document.getElementById('from-amount');
  const rateDisplay = document.getElementById('rate-display');
  const swapBtn = document.querySelector('.swap-btn');
  const historyTbody = document.getElementById('swap-history');
  const walletBtn = document.getElementById('wallet-btn');
  const walletModal = document.getElementById('wallet-modal');
  const walletCloseBtn = document.getElementById('wallet-close-btn');
  const walletAddress = document.getElementById('wallet-address');
  let walletConnected = false;
  const fakeWalletAddress = '0x1234...ABCD5678EF90';

  function formatDate(d) {
    return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')} ${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
  }

  function updateHistory() {
    historyTbody.innerHTML = '';
    swapHistory.slice().reverse().forEach(s => {
      const row = `<tr><td>${formatDate(new Date(s.date))}</td><td>${s.fromToken}</td><td>${s.amount.toFixed(6)}</td><td>${s.toToken}</td><td>${s.received.toFixed(6)}</td></tr>`;
      historyTbody.innerHTML += row;
    });
  }

  async function fetchPrices() {
    const ids = Object.values(tokenIds).join(',');
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
    const data = await res.json();
    for (const [symbol, id] of Object.entries(tokenIds)) {
      usdPrices[symbol] = data[id]?.usd || 0;
    }
  }

  function updateEstimate() {
    const f = fromToken.value;
    const t = toToken.value;
    const a = parseFloat(amountInput.value);
    if (!f || !t || f === t || isNaN(a) || a <= 0) {
      rateDisplay.textContent = 'Select tokens and amount to see estimated rate';
      swapBtn.disabled = true;
      return;
    }
    const rate = usdPrices[f] / usdPrices[t];
    const received = a * rate;
    rateDisplay.textContent = `Estimated: ${received.toFixed(6)} ${t} (1 ${f} â‰ˆ ${rate.toFixed(6)} ${t})`;
    swapBtn.disabled = false;
  }

  function generateUUID() {
    return crypto.randomUUID?.() || 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
      const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  document.getElementById('swap-form').addEventListener('submit', e => {
    e.preventDefault();
    const f = fromToken.value;
    const t = toToken.value;
    const a = parseFloat(amountInput.value);
    const rate = usdPrices[f] / usdPrices[t];
    const received = a * rate;
    const id = generateUUID();
    const data = {
      id,
      fromToken: f,
      toToken: t,
      amount: a,
      received,
      sendUSD: a * usdPrices[f],
      receiveUSD: (a * usdPrices[f]) * 0.99,
      fee: (a * usdPrices[f]) * 0.01,
      destination: fakeWalletAddress,
      date: new Date().toISOString()
    };
    localStorage.setItem('latestSwap', JSON.stringify(data));
    swapHistory.push(data);
    updateHistory();
    window.location.href = `/swap/index.html?swapId=${id}`;
  });

  [fromToken, toToken, amountInput].forEach(el => el.addEventListener('input', updateEstimate));
  walletBtn.addEventListener('click', () => {
    if (!walletConnected) {
      walletModal.classList.add('active');
      walletAddress.textContent = fakeWalletAddress;
      walletBtn.textContent = 'Wallet Connected';
      walletBtn.disabled = true;
      walletConnected = true;
    }
  });
  walletCloseBtn.addEventListener('click', () => walletModal.classList.remove('active'));
  walletModal.addEventListener('click', e => { if (e.target === walletModal) walletModal.classList.remove('active'); });
  window.addEventListener('keydown', e => { if (e.key === 'Escape') walletModal.classList.remove('active'); });

  fetchPrices().then(updateEstimate);
  setInterval(fetchPrices, 60000);
})();
</script>

</body>
</html>
